{% extends 'base.html' %}

{% load django_bootstrap5 %}

{% block content %}
  <div class="container">
    <div>
      <h2>{{ restaurant.name }}</h2>
    </div>
    <div class="px-3">
      <i style="color:red;" class="hart bi bi-heart-fill"></i>
      <span>{{ restaurant.want_go.count }}</span>
      <!-- 즐찾, 조회수 기능 추가-->
      <span>조회수 |
        {{ restaurant.hits }}</span>
    </div>
    <!-- 이미지 -->
    {% if restaurant.image %}
      <img src="{{ restaurant.image.url }}" class="card-img-top">
    {% else %}
      <img src="https://dummyimage.com/900x1200/000000/c4c4c4" class="card-img-top">
    {% endif %}
    <p>매장 영업시간 |
      {{ restaurant.runtime }}</p>
  </div>
  <div class="d-flex">
    <div class="text-center">
      {% if request.user.is_authenticated %}
        {% if request.user in restaurant.like_want_go.all %}
          <a class="title_link" href="{% url 'restaurants:like' restaurant.pk %}">
            <i style="color:red;" class="hart bi bi-heart-fill"></i>
          </a>
        {% else %}
          <a href="{% url 'restaurants:like' restaurant.pk %}">
            <i style="color:red;" class="hart bi bi-heart"></i>
          </a>
          <p>좋아요</p>
        {% endif %}
      {% endif %}
    </div>
  </div>
  <!-- 댓글 -->
  <div class="py-2">
    {% if request.user.is_authenticated %}

      <form action="{% url 'restaurants:comment_create' restaurant.pk %}" method="POST">
        {% csrf_token %}
        {% bootstrap_form form %}
        <br>
        <button class="float-end btn btn-primary ">등록</button>
      </form>
    {% endif %}
    <div class=" py-5">
      <h6 class="mt-3">
        댓글 수 :
        {{ restaurant.comment_set.count }}</h6>
      <hr>

      {% for comment in comments %}
        <div>
          <div>
            <p class=" fw-bold fs-5 m-0">{{ comment.user.username }}
              <a class="title_link" href="{% url 'accounts:detail' comment.user.pk%}">
                <i style="color: black;" class="bi bi-person-circle px-2"></i>
              </a>
            </p>
            <p class="fs-6">{{ comment.created_at|date:"SHORT_DATETIME_FORMAT" }}</p>
            <p class="m-0 fs-6">{{ comment.content }}</p>

            <div>
              <form action="{% url 'restaurants:comment_delete' restaurant.pk comment.pk %}" method="POST">
                {% csrf_token %}
                <div>
                  {% if comment.grade == 1 %}
                    <p>
                      <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                      <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                      <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                      <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                      <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                    </p>
                  {% elif comment.grade == 2 %}
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                  {% elif comment.grade == 3 %}
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                  {% elif comment.grade == 4 %}
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star"></i>
                  {% elif comment.grade == 5 %}
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                    <i style="color:rgb(255, 86, 86);" class="hart bi bi-star-fill"></i>
                  </p>
                {% endif %}
              </div>
              {% if request.user == comment.user %}
                <button class="btn btn-link p-0" style="color: red; text-decoration: none;">삭제</button>
              </form>
            {% endif %}
          </div>
        </div>
        <hr>
        {% empty %}
        <p>댓글이 없습니다.</p>
      {% endfor %}
    </div>
  </div>
  <div>
    <a class="float-end btn btn-dark m-1" href="{% url 'restaurants:index' %}">목록</a>
    {% if request.user == restaurant.user %}
      <a class="float-end btn btn-primary m-1" href="{% url 'restaurants:update' restaurant.pk %}">
        수정
      </a>
      <a class="float-end btn btn-danger m-1" href="{% url 'restaurants:delete' restaurant.pk %}">
        삭제
      </a>
    {% endif %}

  </div>
</div>
{% endblock %}